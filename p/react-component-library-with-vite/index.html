<!doctype html><html lang=en-us dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content="Using Vite's library mode to build a React component library"><title>Creating a React component library with Vite</title><link rel=canonical href=https://vivecuervo7.github.io/dev-blog/p/react-component-library-with-vite/><link rel=stylesheet href=/dev-blog/scss/style.min.b76e6febe05082f0b22ad4c28706b2a37cac056344f4ac3f6e4d653ab9e48217.css><meta property='og:title' content="Creating a React component library with Vite"><meta property='og:description' content="Using Vite's library mode to build a React component library"><meta property='og:url' content='https://vivecuervo7.github.io/dev-blog/p/react-component-library-with-vite/'><meta property='og:site_name' content='Isaac Dedini'><meta property='og:type' content='article'><meta property='article:section' content='Post'><meta property='article:tag' content='React'><meta property='article:tag' content='Vite'><meta property='article:tag' content='Rollup'><meta property='article:tag' content='Storybook'><meta property='article:tag' content='Vitest'><meta property='article:published_time' content='2024-10-08T00:00:00+00:00'><meta property='article:modified_time' content='2024-10-08T00:00:00+00:00'><meta property='og:image' content='https://vivecuervo7.github.io/dev-blog/p/react-component-library-with-vite/cover.jpg'><meta name=twitter:title content="Creating a React component library with Vite"><meta name=twitter:description content="Using Vite's library mode to build a React component library"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content='https://vivecuervo7.github.io/dev-blog/p/react-component-library-with-vite/cover.jpg'><link rel="shortcut icon" href=/dev-blog/favicon.ico></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label="Toggle Menu">
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/dev-blog/><img src=/dev-blog/img/avatar_hu_d49d25d3a05488f7.jpg width=300 height=300 class=site-logo loading=lazy alt=Avatar></a></figure><div class=site-meta><h1 class=site-name><a href=/dev-blog>Isaac Dedini</a></h1><h2 class=site-description></h2></div></header><ol class=menu id=main-menu><li><a href=/dev-blog/><svg class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>Home</span></a></li><li><a href=/dev-blog/archives/><svg class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>Archives</span></a></li><li><a href=/dev-blog/search/><svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
<span>Search</span></a></li><li class=menu-bottom-section><ol class=menu><li id=dark-mode-toggle><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>Dark Mode</span></li></ol></li></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">Table of contents</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#rollup>Rollup</a></li><li><a href=#vite>Vite</a><ol><li><a href=#exporting-components>Exporting components</a></li><li><a href=#library-mode>Library mode</a><ol><li><a href=#dependencies>Dependencies</a></li><li><a href=#entry-points-and-css>Entry points and CSS</a></li><li><a href=#type-generation>Type generation</a></li><li><a href=#setting-up-packagejson>Setting up package.json</a></li></ol></li></ol></li><li><a href=#development>Development</a><ol><li><a href=#storybook>Storybook</a></li><li><a href=#vitest>Vitest</a></li></ol></li><li><a href=#using-the-library>Using the library</a><ol><li><a href=#sample-repository>Sample repository</a></li></ol></li></ol></nav></div></section></aside><main class="main full-width"><article class="has-image main-article"><header class=article-header><div class=article-image><a href=/dev-blog/p/react-component-library-with-vite/><img src=/dev-blog/p/react-component-library-with-vite/cover_hu_4169701d86bc750f.jpg srcset="/dev-blog/p/react-component-library-with-vite/cover_hu_4169701d86bc750f.jpg 800w, /dev-blog/p/react-component-library-with-vite/cover_hu_7ad24db52b1812c9.jpg 1600w" width=800 height=357 loading=lazy alt="Featured image of post Creating a React component library with Vite"></a></div><div class=article-details><header class=article-category><a href=/dev-blog/categories/development/ style=background-color:#1c4269;color:#fff>Development
</a><a href=/dev-blog/categories/react/ style=background-color:#58c5dc;color:#fff>React</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/dev-blog/p/react-component-library-with-vite/>Creating a React component library with Vite</a></h2><h3 class=article-subtitle>Using Vite's library mode to build a React component library</h3></div><footer class=article-time><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>Oct 08, 2024</time></div><div><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>9 minute read</time></div></footer></div></header><section class=article-content><p>A brief discussion with a client recently reminded me of something I&rsquo;d long wanted to look into. The conversation was around the consolidation of designs across their rather broad suite of applications, and given the frequency with which React was used it got me wondering if it might be worth looking into creating a reusable component library.</p><p>Plenty of resources popped up when I started looking into the topic, and ultimately I discovered two promising avenues:</p><ul><li>Rollup</li><li>Vite (or more specifically, Vite&rsquo;s <a class=link href=https://vite.dev/guide/build.html#library-mode target=_blank rel=noopener>Library Mode</a>)</li></ul><p>Of the above options, Rollup seemed to be the more &ldquo;traditional&rdquo; approach and so that&rsquo;s where I started.</p><h2 id=rollup>Rollup</h2><p><a class=link href=https://dev.to/alexeagleson/how-to-create-and-publish-a-react-component-library-2oe target=_blank rel=noopener>This post</a> by <a class=link href=https://dev.to/alexeagleson target=_blank rel=noopener>Alex Eagleson</a> was instrumental in helping me get my head around what needed to be done. There&rsquo;s also a fantastic accompanying video tutorial linked on his post.</p><p>The tutorial is a little outdated so not all of the steps work as described, however there is a good amount of discussion in the comments with updated instructions. In any case, it proved to be informative enough to get me started in building a component library.</p><p>Hopefully it saves any pain, but one thing that caught me was a change to <code>@rollup/plugin-typescript</code> in version 12 which was causing errors, especially when trying to create multiple outputs. Rolling back to version 11 restored the original functionality and allowed me to progress with the tutorial.</p><p>This resource was incredibly helpful in introducing me to the core concepts of how to bundle and publish a component library, and I highly recommend reading through it for anyone unfamiliar with Rollup and how to use it in this context.</p><h2 id=vite>Vite</h2><p>After running through the tutorial above and using the resulting library&rsquo;s simple button component in another React application, I decided to look at Vite before continuing.</p><p>Of the resources I used, <a class=link href=https://victorlillo.dev/blog/react-typescript-vite-component-library target=_blank rel=noopener>this post</a> by <a class=link href=https://victorlillo.dev/ target=_blank rel=noopener>Víctor Lillo</a> proved to be the most complete as it covered all of the aspects I wanted to look at.</p><p>Initially I disliked this approach due to the need to create a full-blown React application and subsequently remove all the bits we didn&rsquo;t need, however it was still <em>relatively</em> painless and came with a few nice things working straight out of the box — CSS as an example.</p><h3 id=exporting-components>Exporting components</h3><p>I did prefer the way components were exported in the first tutorial I followed, so I stuck with that here. This approach used an explicit <code>index.ts</code> file at each level of the hierarchy.</p><div class=code-hint-block><span class=code-hint-path></span><span class=code-hint>src/components/Button/index.ts</span></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-typescript data-lang=typescript><span class=line><span class=cl><span class=kr>export</span> <span class=p>{</span> <span class=k>default</span> <span class=p>}</span> <span class=kr>from</span> <span class=s2>&#34;./Button&#34;</span><span class=p>;</span>
</span></span></code></pre></td></tr></table></div></div><div class=code-hint-block><span class=code-hint-path></span><span class=code-hint>src/components/index.ts</span></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-typescript data-lang=typescript><span class=line><span class=cl><span class=kr>export</span> <span class=p>{</span> <span class=k>default</span> <span class=kr>as</span> <span class=nx>Button</span> <span class=p>}</span> <span class=kr>from</span> <span class=s2>&#34;./Button&#34;</span><span class=p>;</span>
</span></span></code></pre></td></tr></table></div></div><div class=code-hint-block><span class=code-hint-path></span><span class=code-hint>src/index.ts</span></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-typescript data-lang=typescript><span class=line><span class=cl><span class=kr>export</span> <span class=o>*</span> <span class=kr>from</span> <span class=s2>&#34;./components&#34;</span><span class=p>;</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=library-mode>Library mode</h3><p>The initial config required on the Vite side was relatively straightforward. Setting the required values for <code>build.lib</code> under <code>vite.config.ts</code> is all we needed, where we set our entry point.</p><div class=code-hint-block><span class=code-hint-path></span><span class=code-hint>vite.config.ts</span></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-typescript data-lang=typescript><span class=line><span class=cl><span class=c1>/// &lt;reference types=&#34;vite/client&#34; /&gt;
</span></span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>resolve</span> <span class=p>}</span> <span class=kr>from</span> <span class=s2>&#34;node:path&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>defineConfig</span> <span class=p>}</span> <span class=kr>from</span> <span class=s2>&#34;vite&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>react</span> <span class=kr>from</span> <span class=s2>&#34;@vitejs/plugin-react&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=nx>defineConfig</span><span class=p>({</span>
</span></span><span class=line><span class=cl>  <span class=nx>plugins</span><span class=o>:</span> <span class=p>[</span><span class=nx>react</span><span class=p>()],</span>
</span></span><span class=line><span class=cl>  <span class=nx>build</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>lib</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>entry</span>: <span class=kt>resolve</span><span class=p>(</span><span class=nx>__dirname</span><span class=p>,</span> <span class=s2>&#34;src/index.ts&#34;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>      <span class=nx>formats</span><span class=o>:</span> <span class=p>[</span><span class=s2>&#34;es&#34;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=dependencies>Dependencies</h4><p>Another important piece of configuration here is to make sure we&rsquo;re not bundling up a bunch of dependencies that we don&rsquo;t need, such as React itself. We do this by extending <code>vite.config.ts</code> to include <code>build.rollupOptions</code> under both <code>external</code> and <code>output.globals</code>.</p><div class=code-hint-block><span class=code-hint-path></span><span class=code-hint>vite.config.ts</span></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-typescript data-lang=typescript><span class=line><span class=cl><span class=c1>//...
</span></span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=nx>defineConfig</span><span class=p>({</span>
</span></span><span class=line><span class=cl>  <span class=nx>plugins</span><span class=o>:</span> <span class=c1>//...,
</span></span></span><span class=line><span class=cl>  <span class=nx>build</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>lib</span><span class=o>:</span> <span class=c1>//...,
</span></span></span><span class=line><span class=cl>    <span class=nx>rollupOptions</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>external</span><span class=o>:</span> <span class=p>[</span><span class=s2>&#34;react&#34;</span><span class=p>,</span> <span class=s2>&#34;react-dom&#34;</span><span class=p>,</span> <span class=s2>&#34;react/jsx-runtime&#34;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>      <span class=nx>output</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>globals</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nx>react</span><span class=o>:</span> <span class=s2>&#34;React&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=s2>&#34;react-dom&#34;</span><span class=o>:</span> <span class=s2>&#34;React-dom&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=s2>&#34;react/jsx-runtime&#34;</span><span class=o>:</span> <span class=s2>&#34;react/jsx-runtime&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=p>},</span>
</span></span><span class=line><span class=cl>      <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span></code></pre></td></tr></table></div></div><p>In my particular case, I was using <code>classnames</code> as a dependency for some styling, and ran into a few options when it came to ensuring any consumers of the library would have all the required dependencies.</p><p><strong>Bundled with the application</strong></p><p>Leaving <code>classnames</code> under <code>devDependencies</code> in <code>package.json</code> and simply having referenced it in the bundled code meant that <code>classnames</code> itself would also be bundled into the library itself. While there may be some cases where this makes sense, if the consuming application was using <code>classnames</code> already then we&rsquo;ve essentially forced them to bundle the code in their application twice.</p><p><strong>Making it a regular dependency</strong></p><p>Moving <code>classnames</code> into the <code>dependencies</code> list in <code>package.json</code> might work, but that would lead to the consuming application needing to unnecessarily include <code>classnames</code> as a runtime dependency.</p><p><strong>Peer dependencies</strong></p><p>Having not seen this prior to the covered tutorials, it took some reasoning to understand what this was used for. Essentially, moving <code>classnames</code> into the <code>peerDependencies</code> would mean that it was a requirement of the library that the consuming application must have a matching version of the package installed. Thus, some leniency was required when specifying the version.</p><p>Installation was a concern that crossed my mind, however as of npm 7 <a class=link href=https://github.blog/news-insights/product-news/npm-7-is-now-generally-available/#peer-dependencies target=_blank rel=noopener>peer dependencies are installed by default</a>, meaning that a consumer need not go and manually install the peer dependencies themselves.</p><p>Ultimately I went with the <strong>peer dependencies</strong> approach as it seemed to have the fewest drawbacks.</p><h4 id=entry-points-and-css>Entry points and CSS</h4><p>As mentioned in the tutorial, style sheets aren&rsquo;t automatically imported in the generated code and thus the consumer needs to import it themselves manually. This can be resolved by using the <a class=link href=https://www.npmjs.com/package/vite-plugin-lib-inject-css target=_blank rel=noopener>vite-plugin-lib-inject-css</a> plugin. Once installed, it needs to be added to <code>vite.config.ts</code> under <code>plugins</code>.</p><p>This fixes our issue, however we now have a single import statement in our generated <code>index.js</code> file, meaning the entire style sheet needs to be imported if we use even a single component from our library. <a class=link href=https://rollupjs.org/configuration-options/#input target=_blank rel=noopener>Rollup recommends</a> that we instead turn every file into an entry point, which will result in individual CSS files for each component — allowing us to import and use a single component, and only require that component&rsquo;s style sheet.</p><p>Adding the following to <code>build.rollupOptions</code> allows us to generate individual files for each component. The addition to <code>build.rollupOptions.output</code> is also necessary to retain our folder structure in the generated code.</p><div class=code-hint-block><span class=code-hint-path></span><span class=code-hint>vite.config.ts</span></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-diff data-lang=diff><span class=line><span class=cl>export default defineConfig({
</span></span><span class=line><span class=cl>  build: {
</span></span><span class=line><span class=cl>    rollupOptions: {
</span></span><span class=line><span class=cl><span class=gi>+     input: Object.fromEntries(
</span></span></span><span class=line><span class=cl><span class=gi>+       glob
</span></span></span><span class=line><span class=cl><span class=gi>+         .sync(&#39;src/**/*.{ts,tsx}&#39;)
</span></span></span><span class=line><span class=cl><span class=gi>+         .map((file: string) =&gt; [
</span></span></span><span class=line><span class=cl><span class=gi>+           path.relative(&#39;src&#39;, file.slice(0, file.length - path.extname(file).length)),
</span></span></span><span class=line><span class=cl><span class=gi>+           fileURLToPath(new URL(file, import.meta.url))
</span></span></span><span class=line><span class=cl><span class=gi>+         ])
</span></span></span><span class=line><span class=cl><span class=gi>+     ),
</span></span></span><span class=line><span class=cl>      output: {
</span></span><span class=line><span class=cl><span class=gi>+       entryFileNames: &#39;[name].js&#39;,
</span></span></span><span class=line><span class=cl><span class=gi>+       assetFileNames: &#39;assets/[name][extname]&#39;
</span></span></span><span class=line><span class=cl>      },
</span></span><span class=line><span class=cl>    },
</span></span><span class=line><span class=cl>  },
</span></span><span class=line><span class=cl>})
</span></span></code></pre></td></tr></table></div></div><p>This will result in the <code>dist/assets/</code> folder containing a CSS file for each component, which are imported accordingly.</p><h4 id=type-generation>Type generation</h4><p><a class=link href=https://www.npmjs.com/package/vite-plugin-dts target=_blank rel=noopener>vite-plugin-dts</a> is the plugin required to generate our type declarations. Similar to <code>vite-plugin-lib-inject-css</code>, install it and add it to the <code>plugins</code> array in <code>vite.config.ts</code>.</p><p>Again bridging the two tutorials, I preferred the single-file approach taken by the first tutorial, and as such I added the plugin with the option <code>rollupTypes</code> set to <code>true</code>.</p><p>Assuming the <code>rollupTypes</code> option was enabled, the generated code should now contain an <code>index.d.ts</code> file with all of the types declared within it.</p><h4 id=setting-up-packagejson>Setting up package.json</h4><p>The other important file that requires some changes is the <code>package.json</code> file. Add or update the following fields.</p><div class=code-hint-block><span class=code-hint-path></span><span class=code-hint>package.json</span></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-diff data-lang=diff><span class=line><span class=cl>{
</span></span><span class=line><span class=cl><span class=gi>+ &#34;type&#34;: &#34;module&#34;,
</span></span></span><span class=line><span class=cl><span class=gi>+ &#34;files&#34;: [&#34;dist&#34;],
</span></span></span><span class=line><span class=cl><span class=gi>+ &#34;module&#34;: &#34;dist/index.js&#34;,
</span></span></span><span class=line><span class=cl><span class=gi>+ &#34;types&#34;: &#34;dist/index.d.ts&#34;
</span></span></span><span class=line><span class=cl>}
</span></span></code></pre></td></tr></table></div></div><p>Some more information regarding the new or updated fields:</p><ul><li><code>type</code>: should be set to <code>module</code>. to indicate that we&rsquo;re using ES module syntax</li><li><code>files</code>: describes the files to be included when the package is published</li><li><code>module</code>: not an official Node feature, but supported by some bundlers</li><li><code>types</code>: exposes the type declarations entry point</li><li><code>exports</code>: <em>Optional</em> the entry points to the library</li><li><code>main</code>: This is used to specify the entry point for <code>cjs</code>, which we&rsquo;re not supporting</li></ul><p><strong>Life cycle scripts</strong></p><p>A script is also useful to specify here. While using <code>prepublishOnly</code> makes sense if we&rsquo;re planning to publish the library via <code>npm publish</code>, using <code>prepare</code> will run both on <code>npm publish</code> and <code>npm install</code> which allows us to install the library locally.</p><p>Add the following to <code>package.json</code> under <code>scripts</code>.</p><div class=code-hint-block><span class=code-hint-path></span><span class=code-hint>package.json</span></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-diff data-lang=diff><span class=line><span class=cl>{
</span></span><span class=line><span class=cl>  &#34;scripts&#34;: {
</span></span><span class=line><span class=cl><span class=gi>+   &#34;prepare&#34;: &#34;vite build&#34;
</span></span></span><span class=line><span class=cl>  }
</span></span><span class=line><span class=cl>}
</span></span></code></pre></td></tr></table></div></div><p>More information on these &ldquo;life cycle scripts&rdquo; can be found <a class=link href=https://arc.net/l/quote/qplfovup target=_blank rel=noopener>here</a>.</p><h2 id=development>Development</h2><p>The following are simply some additions to the development tooling for the library itself. This won&rsquo;t be a guide on how to use any of the tooling, but simply provides some basic installation steps and ensuring that the files are not bundled into our generated library code.</p><h3 id=storybook>Storybook</h3><p>Storybook can be installed by running the following command.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>pnpm dlx storybook@latest init
</span></span></code></pre></div><p>The <code>src/stories/</code> folder can be removed if desired as it only contains some sample stories and documentation.</p><p>Stories can now be added for any of our components — documentation on how to do so can be found <a class=link href=https://storybook.js.org/docs/writing-stories target=_blank rel=noopener>here</a>. Once stories have been added, run Storybook with the following command.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>pnpm storybook
</span></span></code></pre></div><p><strong>Ignoring Storybook files</strong></p><p>The last thing we need to do here is to ensure that we aren&rsquo;t bundling our stories in the generated code. We do this by extending the <code>glob.sync</code> command we added to <code>build.rollupOptions.input</code> in <code>vite.config.ts</code> and providing an <code>ignore</code> field to the options as follows.</p><div class=code-hint-block><span class=code-hint-path></span><span class=code-hint>vite.config.ts</span></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-typescript data-lang=typescript><span class=line><span class=cl><span class=nx>glob</span><span class=p>.</span><span class=nx>sync</span><span class=p>(</span><span class=s2>&#34;src/**/*.{ts,tsx}&#34;</span><span class=p>,</span> <span class=p>{</span> <span class=nx>ignore</span><span class=o>:</span> <span class=p>[</span><span class=s2>&#34;src/**/*.stories.{ts,tsx}&#34;</span><span class=p>]</span> <span class=p>});</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=vitest>Vitest</h3><p>Vitest, jsdom and the React Testing Library (we&rsquo;ll need all three) can be installed with the following command.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>pnpm i -D vitest jsdom @testing-library/react
</span></span></code></pre></div><p>Add a <code>test</code> script to <code>package.json</code>.</p><div class=code-hint-block><span class=code-hint-path></span><span class=code-hint>package.json</span></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-diff data-lang=diff><span class=line><span class=cl>{
</span></span><span class=line><span class=cl>  &#34;scripts&#34;: {
</span></span><span class=line><span class=cl><span class=gi>+   &#34;test&#34;: &#34;vitest&#34;
</span></span></span><span class=line><span class=cl>  }
</span></span><span class=line><span class=cl>}
</span></span></code></pre></td></tr></table></div></div><p>Next we need to update our <code>vite.config.ts</code> file.</p><div class=code-hint-block><span class=code-hint-path></span><span class=code-hint>vite.config.ts</span></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-diff data-lang=diff><span class=line><span class=cl><span class=gi>+/// &lt;reference types=&#34;vitest&#34; /&gt;
</span></span></span><span class=line><span class=cl>export default defineConfig({
</span></span><span class=line><span class=cl><span class=gi>+ test: {
</span></span></span><span class=line><span class=cl><span class=gi>+   environment: &#34;jsdom&#34;,
</span></span></span><span class=line><span class=cl><span class=gi>+   globals: true,
</span></span></span><span class=line><span class=cl><span class=gi>+   root: &#34;src/&#34;,
</span></span></span><span class=line><span class=cl><span class=gi>+ },
</span></span></span><span class=line><span class=cl>});
</span></span></code></pre></td></tr></table></div></div><p>And to get those globals working nicely so we don&rsquo;t need to repeatedly import <code>describe</code>, <code>test</code> etc. we need to add the following to <code>tsconfig.json</code> under <code>compilerOptions</code>.</p><div class=code-hint-block><span class=code-hint-path></span><span class=code-hint>tsconfig.json</span></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-diff data-lang=diff><span class=line><span class=cl>{
</span></span><span class=line><span class=cl>  &#34;compilerOptions&#34;: {
</span></span><span class=line><span class=cl><span class=gi>+   &#34;types&#34;: [&#34;vitest/globals&#34;]
</span></span></span><span class=line><span class=cl>  }
</span></span><span class=line><span class=cl>}
</span></span></code></pre></td></tr></table></div></div><p><strong>Ignoring test files</strong></p><p>Similar to Storybook, we also need to make sure we&rsquo;re not generated code for our tests. Update the <code>glob.sync</code> command in <code>vite.config.ts</code> under <code>build.rollupOptions.input</code>.</p><div class=code-hint-block><span class=code-hint-path></span><span class=code-hint>vite.config.ts</span></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-typescript data-lang=typescript><span class=line><span class=cl><span class=nx>glob</span><span class=p>.</span><span class=nx>sync</span><span class=p>(</span><span class=s2>&#34;src/**/*.{ts,tsx}&#34;</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>ignore</span><span class=o>:</span> <span class=p>[</span><span class=s2>&#34;src/**/*.stories.{ts,tsx}&#34;</span><span class=p>,</span> <span class=s2>&#34;src/**/*.test.{ts,tsx}&#34;</span><span class=p>],</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=using-the-library>Using the library</h2><p>Both of the linked tutorials go into publishing the library on npm, however due to the nature of a sample library I didn&rsquo;t want to delve into the publishing side of things.</p><p>However, outside of publishing it on npm I was unsure as to how I could actually use the library, and to my pleasure it was actually incredibly straightforward.</p><p><strong>Github repository</strong></p><p>Very simple, this allows you to install directly from the repository using the following command.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>pnpm i -D GITHUB_NAME/REPOSITORY_NAME
</span></span></code></pre></div><p>Which results in the following <code>package.json</code> entry under <code>devDependencies</code>.</p><div class=code-hint-block><span class=code-hint-path></span><span class=code-hint>package.json</span></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;PACKAGE_NAME&#34;</span><span class=p>:</span> <span class=s2>&#34;github:GITHUB_NAME/REPOSITORY_NAME&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>Local reference</strong></p><p>Equally as straightforward, the following command can be run to create a local reference.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>pnpm i -D PATH_TO_LIBRARY
</span></span></code></pre></div><p>Which similar to the above results in the following <code>package.json</code> entry under <code>devDependencies</code>.</p><div class=code-hint-block><span class=code-hint-path></span><span class=code-hint>package.json</span></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;PACKAGE_NAME&#34;</span><span class=p>:</span> <span class=s2>&#34;link:PATH_TO_LIBRARY&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=sample-repository>Sample repository</h3><p>I did end up with a functional component library — albeit one with all of two components and a custom hook. It&rsquo;s available on GitHub <a class=link href=https://github.com/vivecuervo7/demolib target=_blank rel=noopener>here</a>, or it can be used as above with the following command.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>pnpm i -D vivecuervo7/demolib
</span></span></code></pre></div></section><footer class=article-footer><section class=article-tags><a href=/dev-blog/tags/react/>React</a>
<a href=/dev-blog/tags/vite/>Vite</a>
<a href=/dev-blog/tags/rollup/>Rollup</a>
<a href=/dev-blog/tags/storybook/>Storybook</a>
<a href=/dev-blog/tags/vitest/>Vitest</a></section><section class=article-copyright><svg class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg>
<span>Licensed under CC BY-NC-SA 4.0</span></section></footer></article><div class="article-list--compact links"><article><a href=https://dev.to/alexeagleson/how-to-create-and-publish-a-react-component-library-2oe target=_blank rel=noopener><div class=article-details><h2 class=article-title>How to Create and Publish a React Component Library</h2><footer class=article-time>A tutorial for creating a React component library with Rollup</footer></div></a></article><article><a href=https://victorlillo.dev/blog/react-typescript-vite-component-librarymenu target=_blank rel=noopener><div class=article-details><h2 class=article-title>Build a React component library with TypeScript and Vite</h2><footer class=article-time>A tutorial for creating a React component library with Vite</footer></div></a></article></div><aside class=related-content--wrapper><h2 class=section-title>Related content</h2><div class=related-content><div class="flex article-list--tile"><article class=has-image><a href=/dev-blog/p/keycloak-react-spa-msal/><div class=article-image><img src=/dev-blog/p/keycloak-react-spa-msal/cover.8071ec6f10364f6ac7b5a4a7835209f1_hu_ecc33b646d24fe9a.jpg width=250 height=150 loading=lazy alt="Featured image of post Using Keycloak with a React SPA + MSAL" data-key=keycloak-react-spa-msal data-hash="md5-gHHsbxA2T2rHtaSng1IJ8Q=="></div><div class=article-details><h2 class=article-title>Using Keycloak with a React SPA + MSAL</h2></div></a></article><article class=has-image><a href=/dev-blog/p/journalling-with-claude/><div class=article-image><img src=/dev-blog/p/journalling-with-claude/cover.24a7ed978e5081fa75c5c0b71b8577bc_hu_982c6a388bcaf40d.jpg width=250 height=150 loading=lazy alt="Featured image of post Automated journalling for AI-assisted development" data-key=journalling-with-claude data-hash="md5-JKftl45Qgfp1xcC3G4V3vA=="></div><div class=article-details><h2 class=article-title>Automated journalling for AI-assisted development</h2></div></a></article><article class=has-image><a href=/dev-blog/p/fine-tuning-an-llm/><div class=article-image><img src=/dev-blog/p/fine-tuning-an-llm/image.3cb94e5459cd6e59d8b5290a1e3ca537_hu_c5f582216c3f460d.png width=250 height=150 loading=lazy alt="Featured image of post RAG to fine-tuning an LLM" data-key=fine-tuning-an-llm data-hash="md5-PLlOVFnNblnYtSkKHjylNw=="></div><div class=article-details><h2 class=article-title>RAG to fine-tuning an LLM</h2></div></a></article><article class=has-image><a href=/dev-blog/p/ollama-local-agent/><div class=article-image><img src=/dev-blog/p/ollama-local-agent/image.60e6144c99615cd0fba35f45855ab0a9_hu_9b8441ba7f7db365.png width=250 height=150 loading=lazy alt="Featured image of post Running AI models locally with Ollama" data-key=ollama-local-agent data-hash="md5-YOYUTJlhXND7o19FhVqwqQ=="></div><div class=article-details><h2 class=article-title>Running AI models locally with Ollama</h2></div></a></article><article class=has-image><a href=/dev-blog/p/deploying-ios-app-to-testflight/><div class=article-image><img src=/dev-blog/p/deploying-ios-app-to-testflight/image.73182ce8e3f7a3580c79b0541c9d3a97_hu_3c36db2f485fa9b4.jpg width=250 height=150 loading=lazy alt="Featured image of post Deploying an iOS app to TestFlight" data-key=deploying-ios-app-to-testflight data-hash="md5-cxgs6OP3o1gMebBUHJ06lw=="></div><div class=article-details><h2 class=article-title>Deploying an iOS app to TestFlight</h2></div></a></article></div></div></aside><footer class=site-footer><section class=copyright>&copy;
2024 -
2026 Isaac Dedini</section><section class=powerby>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.27.0>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/dev-blog/ts/main.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>
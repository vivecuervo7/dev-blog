<!doctype html><html lang=en-us dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content="How to use MSAL with Keycloak as a local auth server"><title>Using Keycloak with a React SPA + MSAL</title><link rel=canonical href=https://vivecuervo7.github.io/dev-blog/p/keycloak-react-spa-msal/><link rel=stylesheet href=/dev-blog/scss/style.min.b76e6febe05082f0b22ad4c28706b2a37cac056344f4ac3f6e4d653ab9e48217.css><meta property='og:title' content="Using Keycloak with a React SPA + MSAL"><meta property='og:description' content="How to use MSAL with Keycloak as a local auth server"><meta property='og:url' content='https://vivecuervo7.github.io/dev-blog/p/keycloak-react-spa-msal/'><meta property='og:site_name' content='Isaac Dedini'><meta property='og:type' content='article'><meta property='article:section' content='Post'><meta property='article:tag' content='Keycloak'><meta property='article:tag' content='Docker'><meta property='article:tag' content='React'><meta property='article:tag' content='MSAL'><meta property='article:tag' content='.NET Core'><meta property='article:published_time' content='2024-08-05T00:00:00+00:00'><meta property='article:modified_time' content='2024-08-05T00:00:00+00:00'><meta property='og:image' content='https://vivecuervo7.github.io/dev-blog/p/keycloak-react-spa-msal/cover.jpg'><meta name=twitter:title content="Using Keycloak with a React SPA + MSAL"><meta name=twitter:description content="How to use MSAL with Keycloak as a local auth server"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content='https://vivecuervo7.github.io/dev-blog/p/keycloak-react-spa-msal/cover.jpg'><link rel="shortcut icon" href=/dev-blog/favicon.ico></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label="Toggle Menu">
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/dev-blog/><img src=/dev-blog/img/avatar_hu_d49d25d3a05488f7.jpg width=300 height=300 class=site-logo loading=lazy alt=Avatar></a></figure><div class=site-meta><h1 class=site-name><a href=/dev-blog>Isaac Dedini</a></h1><h2 class=site-description></h2></div></header><ol class=menu id=main-menu><li><a href=/dev-blog/><svg class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>Home</span></a></li><li><a href=/dev-blog/archives/><svg class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>Archives</span></a></li><li><a href=/dev-blog/search/><svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
<span>Search</span></a></li><li class=menu-bottom-section><ol class=menu><li id=dark-mode-toggle><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>Dark Mode</span></li></ol></li></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">Table of contents</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#running-keycloak-with-https>Running Keycloak with HTTPS</a><ol><li><a href=#creating-a-self-signed-certificate-using-dotnet-dev-certs>Creating a self-signed certificate using dotnet dev-certs</a></li><li><a href=#running-keycloak-with-the-certificate>Running Keycloak with the certificate</a></li></ol></li><li><a href=#configuring-msal-to-work-with-keycloak>Configuring MSAL to work with Keycloak</a><ol><li><a href=#running-react-with-https>Running React with HTTPS</a></li><li><a href=#missing-parameter-id_token_hint>Missing parameter: id_token_hint</a></li></ol></li><li><a href=#optional-adding-a-secured-net-backend>Optional: Adding a secured .NET backend</a></li></ol></nav></div></section></aside><main class="main full-width"><article class="has-image main-article"><header class=article-header><div class=article-image><a href=/dev-blog/p/keycloak-react-spa-msal/><img src=/dev-blog/p/keycloak-react-spa-msal/cover_hu_b54db749bc1d6e12.jpg srcset="/dev-blog/p/keycloak-react-spa-msal/cover_hu_b54db749bc1d6e12.jpg 800w, /dev-blog/p/keycloak-react-spa-msal/cover_hu_a8caa163466b68ce.jpg 1600w" width=800 height=450 loading=lazy alt="Featured image of post Using Keycloak with a React SPA + MSAL"></a></div><div class=article-details><header class=article-category><a href=/dev-blog/categories/development/ style=background-color:#1c4269;color:#fff>Development
</a><a href=/dev-blog/categories/authentication/ style=background-color:#5181b1;color:#fff>Authentication</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/dev-blog/p/keycloak-react-spa-msal/>Using Keycloak with a React SPA + MSAL</a></h2><h3 class=article-subtitle>How to use MSAL with Keycloak as a local auth server</h3></div><footer class=article-time><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>Aug 05, 2024</time></div><div><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>6 minute read</time></div></footer></div></header><section class=article-content><p>One of my main motivations for looking into Keycloak was to decouple local development from a third party authentication server which needed to be configured by the client. More often than not, this is done using Microsoft Entra ID, and in a typical React application we would use MSAL to set up client authentication.</p><p>This serves as a short guide to resolving some of the issues encountered when trying to use MSAL with a locally-configured Keycloak server.</p><p>See the example repo <a class=link href=https://github.com/vivecuervo7/local-auth-with-keycloak-example target=_blank rel=noopener>here</a>.</p><h2 id=running-keycloak-with-https>Running Keycloak with HTTPS</h2><p>Keycloak will be exposed at <a class=link href=http://localhost:8080 target=_blank rel=noopener>http://localhost:8080</a> which is all well and good for most cases, however I was wanting to drop this in as a local auth replacement for MSAL in a typical React project.</p><p>Since <code>@azure/msal-browser</code> <a class=link href=https://github.com/AzureAD/microsoft-authentication-library-for-js/issues/6631 target=_blank rel=noopener>doesn&rsquo;t allow us to use a HTTP authority</a>, the default Keycloak endpoint won&rsquo;t work. The following steps allow for running Keycloak with HTTPS.</p><h3 id=creating-a-self-signed-certificate-using-dotnet-dev-certs>Creating a self-signed certificate using dotnet dev-certs</h3><p>Since dotnet-certs are typically used for local dev when building .NET applications, it seemed easiest to simply repurpose the same tooling to create other local dev certs.</p><p>Create the self-signed certificate by running the following in your terminal, in this case using <code>password</code> as the credential to create the following two files: <code>certificate.crt</code> and <code>certificate.key</code>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>dotnet dev-certs https -ep ./certificate.crt -p password --trust --format PEM
</span></span></code></pre></div><p>Use <code>openssl</code> to decrypt the certificate key, overwriting <code>certificate.key</code> with the decrypted copy.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>openssl rsa -in certificate.key  -out certificate.key
</span></span></code></pre></div><p>As a matter of preference, I tend to rename these files to <code>cert.pem</code> and <code>key.pem</code>. The remainder of this guide assumes this naming.</p><h3 id=running-keycloak-with-the-certificate>Running Keycloak with the certificate</h3><p>The following changes expect that the certificate files we just created are present in a <code>certificates</code> directory. Go ahead and create the folder and copy both the certificate and key into it.</p><p>Create or update your <code>docker-compose.yml</code> file to the following and run by calling <code>docker-compose up -d</code> in your terminal.</p><div class=code-hint-block><span class=code-hint-path></span><span class=code-hint>docker-compose.yml</span></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yml data-lang=yml><span class=line><span class=cl><span class=nt>services</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>keycloak</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>quay.io/keycloak/keycloak:25.0.2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>container_name</span><span class=p>:</span><span class=w> </span><span class=l>keycloak</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=m>8080</span><span class=p>:</span><span class=m>8080</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=m>8443</span><span class=p>:</span><span class=m>8443</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>environment</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>KEYCLOAK_ADMIN=admin</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>KEYCLOAK_ADMIN_PASSWORD=admin</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>./import:/opt/keycloak/data/import</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>./certificates:/opt/keycloak/data/certificates</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>restart</span><span class=p>:</span><span class=w> </span><span class=l>always</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>command</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;start-dev&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;--import-realm&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;--https-certificate-file=/opt/keycloak/data/certificates/cert.pem&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;--https-certificate-key-file=/opt/keycloak/data/certificates/key.pem&#34;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>You can now access the Keycloak server at either <a class=link href=http://localhost:8080 target=_blank rel=noopener>http://localhost:8080</a> or <a class=link href=https://localhost:8443 target=_blank rel=noopener>https://localhost:8443</a>. Using the HTTPS endpoint should allow us to use Keycloak with <a class=link href=https://github.com/AzureAD/microsoft-authentication-library-for-js target=_blank rel=noopener>@azure/msal-browser</a>.</p><h2 id=configuring-msal-to-work-with-keycloak>Configuring MSAL to work with Keycloak</h2><p>Without delving too deep into how we might hold MSAL in a typical React application, the biggest change we need to make is to manually provide some of the configuration that usually works out of the box with MSAL when using Microsoft Entra ID.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-typescript data-lang=typescript><span class=line><span class=cl><span class=kr>const</span> <span class=nx>msalConfig</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>auth</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>clientId</span><span class=o>:</span> <span class=s2>&#34;local-dev-client&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>authority</span><span class=o>:</span> <span class=s2>&#34;https://localhost:8443/realms/local-dev&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>knownAuthorities</span><span class=o>:</span> <span class=p>[</span><span class=s2>&#34;https://localhost:8443/realms/local-dev&#34;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=nx>redirectUri</span><span class=o>:</span> <span class=s2>&#34;https://localhost:5173&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>postLogoutRedirectUri</span><span class=o>:</span> <span class=s2>&#34;https://localhost:5173&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>protocolMode</span>: <span class=kt>ProtocolMode.OIDC</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>authorityMetadata</span>: <span class=kt>JSON.stringify</span><span class=p>({</span>
</span></span><span class=line><span class=cl>      <span class=nx>authorization_endpoint</span><span class=o>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;https://localhost:8443/realms/local-dev/protocol/openid-connect/auth&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>token_endpoint</span><span class=o>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;https://localhost:8443/realms/local-dev/protocol/openid-connect/token&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>issuer</span><span class=o>:</span> <span class=s2>&#34;https://localhost:8443/realms/local-dev&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>userinfo_endpoint</span><span class=o>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;https://localhost:8443/realms/local-dev/protocol/openid-connect/userinfo&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>end_session_endpoint</span><span class=o>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;https://localhost:8443/realms/local-dev/protocol/openid-connect/logout&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>}),</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>msalInstance</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>PublicClientApplication</span><span class=p>(</span><span class=nx>msalConfig</span><span class=p>);</span>
</span></span></code></pre></td></tr></table></div></div><p>There are of course a few more data points required, which may then need to be manually provided again when configuring this to work with both Keycloak locally <em>and</em> Microsoft Entra ID when deployed. A small amount of pain to endure for the benefits of decoupling ourselves from a customer-provided auth server.</p><p>Of course, in practice we would make these string more easily configurable, but I&rsquo;ve opted to hardcode them to better demonstrate.</p><p>See the <a class=link href=https://github.com/vivecuervo7/local-auth-with-keycloak-example target=_blank rel=noopener>sample repo</a> to see these changes in more context.</p><p><strong>OpenID Endpoint Configuration</strong></p><p>The trickier part here might be knowing where to obtain these strings from. Navigating to the realm settings of our Keycloak server&rsquo;s admin interface, find the <strong>OpenID Endpoint Configuration</strong> link.</p><p><img src=/dev-blog/p/keycloak-react-spa-msal/images/realm-settings.jpg width=1408 height=975 srcset="/dev-blog/p/keycloak-react-spa-msal/images/realm-settings_hu_66eef3c4456a13aa.jpg 480w, /dev-blog/p/keycloak-react-spa-msal/images/realm-settings_hu_583d3fc7e108d5c2.jpg 1024w" loading=lazy alt="OpenID Endpoint Configuration link" class=gallery-image data-flex-grow=144 data-flex-basis=346px></p><p>Opening this will yield a new page with all of our endpoints that we need to populate this config.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;issuer&#34;</span><span class=p>:</span> <span class=s2>&#34;https://localhost:8443/realms/local-dev&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;authorization_endpoint&#34;</span><span class=p>:</span> <span class=s2>&#34;https://localhost:8443/realms/local-dev/protocol/openid-connect/auth&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;token_endpoint&#34;</span><span class=p>:</span> <span class=s2>&#34;https://localhost:8443/realms/local-dev/protocol/openid-connect/token&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;userinfo_endpoint&#34;</span><span class=p>:</span> <span class=s2>&#34;https://localhost:8443/realms/local-dev/protocol/openid-connect/userinfo&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;end_session_endpoint&#34;</span><span class=p>:</span> <span class=s2>&#34;https://localhost:8443/realms/local-dev/protocol/openid-connect/logout&#34;</span>
</span></span><span class=line><span class=cl>  <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=running-react-with-https>Running React with HTTPS</h3><p>We may also need to run our React application with HTTPS as well. To achieve this, we need to update <code>vite.config.ts</code> to contain the following. Fortunately, we can repurpose the same certificates we created for Keycloak.</p><p>Note that while omitted below, it may be useful to split the <code>serve</code> and <code>build</code> commands so we keep our changes away from any deployed code.</p><div class=code-hint-block><span class=code-hint-path></span><span class=code-hint>vite.config.ts</span></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-diff data-lang=diff><span class=line><span class=cl>import { defineConfig, loadEnv } from &#34;vite&#34;;
</span></span><span class=line><span class=cl>import react from &#34;@vitejs/plugin-react-swc&#34;;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>export default defineConfig(({ command, mode }) =&gt; {
</span></span><span class=line><span class=cl><span class=gi>+ process.env = { ...process.env, ...loadEnv(mode, process.cwd()) };
</span></span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  return {
</span></span><span class=line><span class=cl>    plugins: [react()],
</span></span><span class=line><span class=cl><span class=gi>+   server: {
</span></span></span><span class=line><span class=cl><span class=gi>+     https: {
</span></span></span><span class=line><span class=cl><span class=gi>+       cert: process.env.VITE_CERT ?? &#34;&#34;,
</span></span></span><span class=line><span class=cl><span class=gi>+       key: process.env.VITE_CERT_KEY ?? &#34;&#34;,
</span></span></span><span class=line><span class=cl><span class=gi>+     },
</span></span></span><span class=line><span class=cl><span class=gi>+   },
</span></span></span><span class=line><span class=cl>  };
</span></span><span class=line><span class=cl>});
</span></span></code></pre></td></tr></table></div></div><p>And then we&rsquo;ll also need to add a <code>.env</code> (and <code>.env.local</code>) with the correct paths.</p><div class=code-hint-block><span class=code-hint-path></span><span class=code-hint>.env</span></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-diff data-lang=diff><span class=line><span class=cl><span class=gi>+ VITE_CERT=../local-dev/certificates/cert.pem
</span></span></span><span class=line><span class=cl><span class=gi>+ VITE_CERT_KEY=../local-dev/certificates/key.pem
</span></span></span></code></pre></td></tr></table></div></div><p>Now running the React application with <code>pnpm dev</code> should serve it using HTTPS.</p><h3 id=missing-parameter-id_token_hint>Missing parameter: id_token_hint</h3><p>I did run into a small issue with the setup, where a user was unable to logout completely. Attempting to logout was yielding an error due to the absence of either a <code>client_id</code> or <code>id_token_hint</code> when requesting the <code>post_logout_redirect_uri</code>.</p><p>Ultimately, this was easily resolved by obtaining an access token <em>before</em> attempting to logout, and using the <code>id_token</code> from that.</p><div class=code-hint-block><span class=code-hint-path></span><span class=code-hint>main.tsx</span></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-typescript data-lang=typescript><span class=line><span class=cl><span class=kr>const</span> <span class=nx>handleLogout</span> <span class=o>=</span> <span class=kr>async</span> <span class=p>()</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>response</span> <span class=o>=</span> <span class=k>await</span> <span class=nx>instance</span><span class=p>.</span><span class=nx>acquireTokenSilent</span><span class=p>({</span>
</span></span><span class=line><span class=cl>    <span class=nx>scopes</span><span class=o>:</span> <span class=p>[</span><span class=s2>&#34;openid&#34;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>  <span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>await</span> <span class=nx>instance</span><span class=p>.</span><span class=nx>logoutRedirect</span><span class=p>({</span>
</span></span><span class=line><span class=cl>    <span class=nx>idTokenHint</span>: <span class=kt>response.idToken</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=optional-adding-a-secured-net-backend>Optional: Adding a secured .NET backend</h2><p>The <a class=link href=https://github.com/vivecuervo7/local-auth-with-keycloak-example target=_blank rel=noopener>sample repo</a> contains code that also connects the React application to a .NET API with a secured endpoint.</p><p>The configuration here is relatively straightforward to work with our local Keycloak server.</p><p>The main changes we&rsquo;ll need to make are to <code>Program.cs</code>, where we simply add our necessary configuration (truncated for brevity).</p><div class=code-hint-block><span class=code-hint-path></span><span class=code-hint>Program.cs</span></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-diff data-lang=diff><span class=line><span class=cl><span class=gi>+ using Microsoft.AspNetCore.Authentication.JwtBearer;
</span></span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  var builder = WebApplication.CreateBuilder(args);
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=gi>+ builder
</span></span></span><span class=line><span class=cl><span class=gi>+     .Services.AddAuthentication(options =&gt;
</span></span></span><span class=line><span class=cl><span class=gi>+     {
</span></span></span><span class=line><span class=cl><span class=gi>+         options.DefaultAuthenticateScheme = JwtBearerDefaults.AuthenticationScheme;
</span></span></span><span class=line><span class=cl><span class=gi>+         options.DefaultChallengeScheme = JwtBearerDefaults.AuthenticationScheme;
</span></span></span><span class=line><span class=cl><span class=gi>+     })
</span></span></span><span class=line><span class=cl><span class=gi>+     .AddJwtBearer(options =&gt; builder.Configuration.Bind(&#34;JwtBearerOptions&#34;, options));
</span></span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=gi>+ builder
</span></span></span><span class=line><span class=cl><span class=gi>+     .Services.AddAuthorizationBuilder()
</span></span></span><span class=line><span class=cl><span class=gi>+     .AddDefaultPolicy(&#34;RequireAuthenticatedUser&#34;, policy =&gt; policy.RequireAuthenticatedUser());
</span></span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  var app = builder.Build();
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  app.UseHttpsRedirection();
</span></span><span class=line><span class=cl><span class=gi>+ app.UseAuthentication();
</span></span></span><span class=line><span class=cl><span class=gi>+ app.UseAuthorization();
</span></span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  app.MapGet(&#34;/weatherforecast&#34;, () =&gt; [])
</span></span><span class=line><span class=cl>    .WithName(&#34;GetWeatherForecast&#34;)
</span></span><span class=line><span class=cl>    .WithOpenApi()
</span></span><span class=line><span class=cl><span class=gi>+   .RequireAuthorization();
</span></span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  await app.RunAsync();
</span></span></code></pre></td></tr></table></div></div><p>And providing the appropriate configuration via appsettings.</p><div class=code-hint-block><span class=code-hint-path></span><span class=code-hint>appsettings.json</span></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-diff data-lang=diff><span class=line><span class=cl>{
</span></span><span class=line><span class=cl><span class=gi>+ &#34;JwtBearerOptions&#34;: {
</span></span></span><span class=line><span class=cl><span class=gi>+   &#34;Authority&#34;: &#34;https://localhost:8443/realms/local-dev&#34;,
</span></span></span><span class=line><span class=cl><span class=gi>+   &#34;Audience&#34;: &#34;local-dev-client&#34;
</span></span></span><span class=line><span class=cl><span class=gi>+ }
</span></span></span><span class=line><span class=cl>}
</span></span></code></pre></td></tr></table></div></div><p>Running the code in the sample repo will result in the React application displaying a button which calls the <code>/weatherforecast</code> endpoint to illustrate the correct responses are returned depending on whether the client has been authenticated or not.</p></section><footer class=article-footer><section class=article-tags><a href=/dev-blog/tags/keycloak/>Keycloak</a>
<a href=/dev-blog/tags/docker/>Docker</a>
<a href=/dev-blog/tags/react/>React</a>
<a href=/dev-blog/tags/msal/>MSAL</a>
<a href=/dev-blog/tags/.net-core/>.NET Core</a></section><section class=article-copyright><svg class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg>
<span>Licensed under CC BY-NC-SA 4.0</span></section></footer></article><div class="article-list--compact links"><article><a href=https://www.keycloak.org/ target=_blank rel=noopener><div class=article-details><h2 class=article-title>Keycloak</h2><footer class=article-time>Open Source Identity and Access Management</footer></div></a></article><article><a href=https://www.docker.com/ target=_blank rel=noopener><div class=article-details><h2 class=article-title>Docker</h2><footer class=article-time>Accelerated Container Application Development</footer></div></a></article><article><a href=https://react.dev/ target=_blank rel=noopener><div class=article-details><h2 class=article-title>React</h2><footer class=article-time>The library for web and native user interfaces</footer></div></a></article><article><a href=https://github.com/AzureAD/microsoft-authentication-library-for-js target=_blank rel=noopener><div class=article-details><h2 class=article-title>MSAL.js</h2><footer class=article-time>Microsoft Authentication Library for JavaScript</footer></div></a></article><article><a href=https://dotnet.microsoft.com/en-us/ target=_blank rel=noopener><div class=article-details><h2 class=article-title>.NET</h2><footer class=article-time>The free, open-source, cross-platform framework for building modern apps and powerful cloud services</footer></div></a></article></div><aside class=related-content--wrapper><h2 class=section-title>Related content</h2><div class=related-content><div class="flex article-list--tile"><article class=has-image><a href=/dev-blog/p/keycloak-import-export/><div class=article-image><img src=/dev-blog/p/keycloak-import-export/cover.8071ec6f10364f6ac7b5a4a7835209f1_hu_ecc33b646d24fe9a.jpg width=250 height=150 loading=lazy alt="Featured image of post Importing and exporting Keycloak configuration" data-key=keycloak-import-export data-hash="md5-gHHsbxA2T2rHtaSng1IJ8Q=="></div><div class=article-details><h2 class=article-title>Importing and exporting Keycloak configuration</h2></div></a></article><article class=has-image><a href=/dev-blog/p/keycloak-setup/><div class=article-image><img src=/dev-blog/p/keycloak-setup/cover.8071ec6f10364f6ac7b5a4a7835209f1_hu_ecc33b646d24fe9a.jpg width=250 height=150 loading=lazy alt="Featured image of post Setting up Keycloak" data-key=keycloak-setup data-hash="md5-gHHsbxA2T2rHtaSng1IJ8Q=="></div><div class=article-details><h2 class=article-title>Setting up Keycloak</h2></div></a></article><article class=has-image><a href=/dev-blog/p/react-component-library-with-vite/><div class=article-image><img src=/dev-blog/p/react-component-library-with-vite/cover.d26b3a871a78a1e0ea99d749c00ba9c7_hu_ab8c56241ac9c6de.jpg width=250 height=150 loading=lazy alt="Featured image of post Creating a React component library with Vite" data-key=react-component-library-with-vite data-hash="md5-0ms6hxp4oeDqmddJwAupxw=="></div><div class=article-details><h2 class=article-title>Creating a React component library with Vite</h2></div></a></article><article class=has-image><a href=/dev-blog/p/journalling-with-claude/><div class=article-image><img src=/dev-blog/p/journalling-with-claude/cover.24a7ed978e5081fa75c5c0b71b8577bc_hu_982c6a388bcaf40d.jpg width=250 height=150 loading=lazy alt="Featured image of post Automated journalling for AI-assisted development" data-key=journalling-with-claude data-hash="md5-JKftl45Qgfp1xcC3G4V3vA=="></div><div class=article-details><h2 class=article-title>Automated journalling for AI-assisted development</h2></div></a></article><article class=has-image><a href=/dev-blog/p/fine-tuning-an-llm/><div class=article-image><img src=/dev-blog/p/fine-tuning-an-llm/image.3cb94e5459cd6e59d8b5290a1e3ca537_hu_c5f582216c3f460d.png width=250 height=150 loading=lazy alt="Featured image of post RAG to fine-tuning an LLM" data-key=fine-tuning-an-llm data-hash="md5-PLlOVFnNblnYtSkKHjylNw=="></div><div class=article-details><h2 class=article-title>RAG to fine-tuning an LLM</h2></div></a></article></div></div></aside><footer class=site-footer><section class=copyright>&copy;
2024 -
2026 Isaac Dedini</section><section class=powerby>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.27.0>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/dev-blog/ts/main.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>